# KeepTrack-CSS — Agent Guide

## Project overview

KeepTrack-CSS is a zero-dependency browser library that reads computed CSS property values from elements and exposes them as CSS custom properties (variables). It supports scrollbar tracking, sticky detection, scroll-padding for anchor links, and more.

## Project structure

```
src/keepTrack.js    — Source of truth (UMD format)
build.js            — Build script (generates dist/)
dist/               — Generated output (not in git)
  keepTrack.js      — UMD copy
  keepTrack.esm.js  — ESM build
  keepTrack.min.js  — Minified UMD
  keepTrack.d.ts    — TypeScript definitions
docs/               — Demo/test page (GitHub Pages)
```

## Key conventions

- **No runtime dependencies.** The library runs in the browser only and must stay dependency-free.
- **UMD source.** `src/keepTrack.js` uses a UMD wrapper (AMD, CommonJS, global). The ESM build is derived from it automatically by `build.js`.
- **No TypeScript source.** Type definitions in `dist/keepTrack.d.ts` are generated by `build.js`, not compiled from `.ts` files. Keep them in sync manually when changing the public API.
- **No transpilation.** The source targets modern browsers directly — no Babel, no bundler.
- **Terser** is the only dev dependency (used for minification).

## Build

```bash
npm run build     # generates dist/ (UMD, ESM, min, d.ts)
```

The `prepare` script also runs `node build.js`, so `npm install` from a git clone will build automatically.

## Public API

The library exports a single factory function:

```js
const tracker = new KeepTrack(options?)
```

Returns an instance with: `init(options?)`, `destroy()`, `recalculate()`, `observe(el)`, `unobserve(el)`.

### Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `scrollbarWidth` | `boolean` | `true` | Track `--scrollbar-width` on `:root` |
| `scrollbarHeight` | `boolean` | `false` | Track `--scrollbar-height` on `:root` |
| `debounceTime` | `number` | `250` | Debounce delay (ms) for resize/DOM changes |
| `poll` | `boolean` | `false` | rAF polling for non-layout property changes |
| `detectSticky` | `boolean` | `false` | Detect stuck state of `position: sticky` elements |
| `stickyTopDynamic` | `boolean` | `false` | Recompute sticky `top` every frame instead of caching |
| `onChange` | `function\|null` | `null` | Callback: `(el, prop, value) => void` |

## HTML data attributes

- `data-keeptrack="height, width, ..."` — comma-separated CSS properties to track
- `data-keeptrack-target-parent="2"` or `".selector"` — set variable on a parent/ancestor instead
- `data-keeptrack-scroll-padding` — include element's height in `scroll-padding-top`

## When editing

- Always edit `src/keepTrack.js`, never `dist/` files directly.
- Run `npm run build` after changes to regenerate dist/.
- If you change the public API (options, methods, return types), update the `dts` string in `build.js` to keep type definitions in sync.
- Test changes using `docs/index.html` which covers all features interactively.
- The demo page loads `../src/keepTrack.js` directly (not the built version).
